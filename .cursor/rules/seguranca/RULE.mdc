---
description: "Segurança: autenticação, validação, proteção de dados e ataques"
alwaysApply: true
---

Authentication and authorization:
- API: Use auth middleware on ALL protected routes
- Zero Trust: Never trust client data; always validate on server
- JWT with sensible expiry (e.g. 15min access, 7d refresh); rotate refresh tokens when possible
- Logout should invalidate tokens on server when feasible
- Never expose tokens or credentials in logs, URLs or error messages
- Validate permissions before accessing resources (RBAC if needed)

Validation and sanitization:
- Validate ALL inputs in API (Zod or similar)
- Sanitize strings (strip scripts, dangerous HTML, SQL injection attempts)
- Validate types, sizes, formats (email, URL, phone); normalize (trim, lowercase where appropriate)
- SQL: use only prepared statements ($1, $2); NEVER concatenate user input in queries

Protection against attacks:
- SQL Injection: prepared statements only (repositories use pg with placeholders)
- XSS: sanitize outputs; Content-Security-Policy headers
- CSRF: validate CSRF tokens on write operations (POST, PUT, DELETE) when applicable
- Rate limiting on routes (stricter on login/register and sensitive endpoints)
- Optional: block IPs after N failed login attempts

Security headers:
- Content-Security-Policy, X-Content-Type-Options: nosniff, X-Frame-Options: DENY or SAMEORIGIN
- Strict-Transport-Security (HTTPS); Referrer-Policy
- Remove headers that expose technology (e.g. X-Powered-By)

Data security:
- Passwords: always hash (bcrypt or Argon2); never plain text
- Sensitive data: encrypt at rest if required (PII, financial)
- Transmission: HTTPS only in production (TLS 1.2+)
- Secrets: only in environment variables or secret managers; never in code
- Logs: never log passwords, tokens or full PII

Access control:
- Least privilege; validate resource ownership when relevant
- Validate in middleware and in service layer
- Database is accessed only by API; frontend never has DB credentials

Environment:
- Never commit .env or secrets; use .env.example with placeholders
- Rotate secrets periodically in production

Checklist:
- Inputs validated in API; passwords hashed; no tokens in logs/URLs
- HTTPS in production; rate limiting; CORS not wildcard in production
- Security headers; parameterized SQL only; auth on protected routes
